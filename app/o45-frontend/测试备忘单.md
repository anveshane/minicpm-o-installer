# 🧪 无机器人超时测试 - 备忘单

## 问题：执行 `window.__testNoRobotTimeout()` 没反应？

### ✅ 立即解决方案

打开控制台（F12），依次执行：

```javascript
// 1️⃣ 先查看状态
window.__debugInfo()
```

查看输出结果：
- ✅ 如果看到表格输出 → 继续下一步
- ❌ 如果报错 undefined → 刷新页面重试

```javascript
// 2️⃣ 强制触发测试（推荐）
window.__testNoRobotTimeout(true)
```

应该看到：
- ✅ 弹出提示框："连接超时，未能成功连接到服务，将自动挂断。"
- ✅ 控制台显示："🧪 强制模式，即使没有定时器也触发超时"

---

## 🎯 三个核心测试命令

| 命令 | 功能 | 使用场景 |
|------|------|----------|
| `window.__testNoRobotTimeout()` | 正常测试 | 已开始通话时 |
| `window.__testNoRobotTimeout(true)` | 强制测试 | 随时可用 ⭐ |
| `window.__debugInfo()` | 查看状态 | 排查问题 |

---

## 📊 状态检查快速指南

```javascript
window.__debugInfo()
```

**关键字段说明：**
```
isCalling          → 是否正在通话
livekitConnected   → 是否连接到房间
remoteParticipants → 远端参与者数量（0=无机器人）
hasActiveTimer     → 定时器是否活跃
```

---

## 🚀 完整测试流程（最简版）

### 方式1：自动等待测试
1. 开始通话
2. 等待 10 秒
3. 看到弹窗 ✅

### 方式2：手动强制测试（推荐）
1. 打开控制台（F12）
2. 执行：`window.__testNoRobotTimeout(true)`
3. 看到弹窗 ✅

---

## ⚠️ 常见错误及解决

### 错误1：`undefined is not a function`
```javascript
// 解决：刷新页面，确保在开发模式
npm run dev
```

### 错误2：没有任何反应
```javascript
// 解决：使用强制模式
window.__testNoRobotTimeout(true)
```

### 错误3：不知道当前状态
```javascript
// 解决：查看调试信息
window.__debugInfo()
```

---

## 🎓 日志关键词速查

| 日志 | 含义 |
|------|------|
| `⏰ 启动无机器人检测定时器` | 定时器已启动 ✅ |
| `✅ 检测到远端参与者加入` | 机器人已加入，正常 ✅ |
| `⚠️ 10秒内未检测到机器人` | 超时触发 ✅ |
| `🧪 强制模式` | 强制测试执行 ✅ |
| `🧪 测试失败：没有活跃的定时器` | 需要强制模式 |

---

## 💡 一句话总结

**遇到问题就用强制模式：** `window.__testNoRobotTimeout(true)`

---

**✅ 环境自动识别，上线无需修改！**  
- localhost：10秒（测试）
- 生产环境：3分钟（正常）

