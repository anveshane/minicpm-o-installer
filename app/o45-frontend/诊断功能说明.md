# LiveKit è¿žæŽ¥æ€§èƒ½è¯Šæ–­åŠŸèƒ½è¯´æ˜Ž

## ðŸ“Š é—®é¢˜èƒŒæ™¯

æµ‹è¯•åŒå­¦åé¦ˆï¼š
- **æµ‹è¯•çŽ¯å¢ƒ**ï¼šæ€»è€—æ—¶ 20631msï¼Œå…¶ä¸­è¿žæŽ¥æˆ¿é—´ 17808ms
- **å¼€å‘çŽ¯å¢ƒ**ï¼šæ€»è€—æ—¶ ~3000msï¼Œå…¶ä¸­è¿žæŽ¥æˆ¿é—´ 300-500ms
- **å·®å¼‚**ï¼šè¿žæŽ¥æˆ¿é—´è€—æ—¶ç›¸å·®çº¦ **35-59å€**

## âœ… å·²å®Œæˆçš„æ”¹è¿›

### 1. çŽ¯å¢ƒä¿¡æ¯è‡ªåŠ¨æ”¶é›†
è¿žæŽ¥å¼€å§‹æ—¶è‡ªåŠ¨æ”¶é›†ï¼š
- æµè§ˆå™¨ä¿¡æ¯ï¼ˆUAã€åŽ‚å•†ã€ç‰ˆæœ¬ï¼‰
- ç½‘ç»œçŠ¶æ€ï¼ˆè¿žæŽ¥ç±»åž‹ã€å¸¦å®½ã€å»¶è¿Ÿï¼‰
- ç³»ç»Ÿä¿¡æ¯ï¼ˆå¹³å°ã€è¯­è¨€ã€å†…å­˜ï¼‰
- LiveKité…ç½®ä¿¡æ¯

### 2. ç½‘ç»œè´¨é‡é¢„æ£€æµ‹
è¿žæŽ¥å‰è‡ªåŠ¨æ£€æµ‹ï¼š
- âœ… åœ¨çº¿çŠ¶æ€
- ðŸŒ ç½‘ç»œç±»åž‹ï¼ˆ4G/3G/2Gï¼‰
- â±ï¸ ç½‘ç»œå»¶è¿Ÿï¼ˆRTTï¼‰
- ðŸ“¶ å¸¦å®½ä¼°è®¡
- âš ï¸ æ…¢é€Ÿç½‘ç»œè‡ªåŠ¨é¢„è­¦

### 3. è¿žæŽ¥è¿›åº¦å®žæ—¶ç›‘æŽ§
- æ¯ 2 ç§’è¾“å‡ºä¸€æ¬¡è¿›åº¦
- è¶…è¿‡ 15 ç§’è‡ªåŠ¨è­¦å‘Š
- æ˜¾ç¤ºå½“å‰è¿žæŽ¥çŠ¶æ€

### 4. ICE è¿žæŽ¥è¯Šæ–­ï¼ˆå…³é”®ï¼ï¼‰
è‡ªåŠ¨æ£€æµ‹å¹¶æ˜¾ç¤ºï¼š
- ICE å€™é€‰æ”¶é›†è¿‡ç¨‹
- ICE è¿žæŽ¥å»ºç«‹è¿‡ç¨‹
- **æœ€ç»ˆè¿žæŽ¥ç±»åž‹**ï¼š
  - âš¡ ç›´è¿žï¼ˆæœ€å¿«ï¼‰
  - ðŸŒ STUNç©¿é€ï¼ˆæ­£å¸¸ï¼‰
  - ðŸ”„ **TURNä¸­ç»§ï¼ˆæ…¢ï¼‰** â† å¯èƒ½æ˜¯ä¸»è¦é—®é¢˜ï¼
  
å¦‚æžœæ£€æµ‹åˆ°ä½¿ç”¨ TURN ä¸­ç»§ï¼Œä¼šæ˜¾ç¤ºè¯¦ç»†è­¦å‘Šå’ŒåŽŸå› åˆ†æžã€‚

### 5. å„é˜¶æ®µè€—æ—¶è¯¦ç»†åˆ†æž
æ¯ä¸ªé˜¶æ®µéƒ½ä¼šæ ‡æ³¨ï¼š
- å®žé™…è€—æ—¶
- æ€§èƒ½è¯„çº§ï¼ˆâœ…æ­£å¸¸ / âš¡ç•¥æ…¢ / âš ï¸è¾ƒæ…¢ / ðŸ”´å¾ˆæ…¢ï¼‰
- ä¸Žæ­£å¸¸å€¼å¯¹æ¯”ï¼ˆå€æ•°ï¼‰

### 6. æ™ºèƒ½è¯Šæ–­å»ºè®®
æ ¹æ®å®žé™…è€—æ—¶è‡ªåŠ¨ç»™å‡ºï¼š
- é—®é¢˜åˆ†æž
- å¯èƒ½çš„åŽŸå› 
- å…·ä½“çš„ä¼˜åŒ–å»ºè®®

### 7. å®Œæ•´è¯Šæ–­æŠ¥å‘Š
è‡ªåŠ¨ç”ŸæˆåŒ…å«æ‰€æœ‰ä¿¡æ¯çš„å®Œæ•´æŠ¥å‘Šï¼Œå¯ä»¥ï¼š
- åœ¨æŽ§åˆ¶å°æŸ¥çœ‹
- å¤åˆ¶ä¸ºæ–‡æœ¬
- å‘é€ç»™å¼€å‘è€…

## ðŸŽ¯ å¦‚ä½•ä½¿ç”¨

### ç»™æµ‹è¯•åŒå­¦ï¼š

1. **æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·**
   ```
   Chrome/Edge: F12 æˆ– Ctrl+Shift+I (Win) / Cmd+Option+I (Mac)
   åˆ‡æ¢åˆ° Console æ ‡ç­¾
   ```

2. **è§¦å‘è¿žæŽ¥å¹¶è§‚å¯Ÿæ—¥å¿—**
   - æ—¥å¿—ä¼šä»¥å½©è‰²æ˜¾ç¤ºï¼Œéžå¸¸ç›´è§‚
   - é‡ç‚¹å…³æ³¨ã€Œè¿žæŽ¥æˆ¿é—´ã€çš„è€—æ—¶

3. **æŸ¥çœ‹å…³é”®ä¿¡æ¯**
   ```
   ðŸ” [è¯Šæ–­] ç½‘ç»œçŠ¶æ€
   ðŸ”Œ [å¼€å§‹è¿žæŽ¥] è°ƒç”¨ room.connect()...
   â³ [è¿žæŽ¥ä¸­] å·²ç­‰å¾… X.Xç§’...
   ðŸ§Š [è¯Šæ–­] ICEè¿žæŽ¥çŠ¶æ€
   âš ï¸ æ£€æµ‹åˆ°ä½¿ç”¨TURNä¸­ç»§è¿žæŽ¥ï¼  â† é‡ç‚¹ï¼
   ðŸ“Š æ€§èƒ½åŸºå‡†å¯¹æ¯”
   ```

4. **å¤åˆ¶è¯Šæ–­æŠ¥å‘Š**
   - æ»šåŠ¨åˆ°åº•éƒ¨æ‰¾åˆ°ã€ŒðŸ“‹ å®Œæ•´è¯Šæ–­æŠ¥å‘Šã€
   - å³é”®å¯¹è±¡ â†’ "Store as global variable" â†’ è¾“å…¥ `copy(temp1)`
   - æˆ–ç›´æŽ¥å¤åˆ¶ã€ŒðŸ“„ æ–‡æœ¬ç‰ˆæœ¬ã€

5. **ä¹Ÿå¯ä»¥æ‰‹åŠ¨å¯¼å‡º**
   ```javascript
   // åœ¨æŽ§åˆ¶å°è¾“å…¥ï¼š
   window.exportLiveKitDiagnostic()
   ```

## ðŸ” å¿«é€Ÿåˆ¤æ–­é—®é¢˜

### å¦‚æžœè¿žæŽ¥æˆ¿é—´ > 5000msï¼š

1. **æŸ¥çœ‹æ˜¯å¦ä½¿ç”¨ TURN ä¸­ç»§**
   ```
   æœç´¢æ—¥å¿—ä¸­çš„å…³é”®è¯ï¼š
   "TURNä¸­ç»§" æˆ– "relay"
   ```
   
   å¦‚æžœçœ‹åˆ°ï¼š
   ```
   âš ï¸ æ£€æµ‹åˆ°ä½¿ç”¨TURNä¸­ç»§è¿žæŽ¥ï¼è¿™ä¼šå¢žåŠ å»¶è¿Ÿ
   ```
   **è¯´æ˜Žæ˜¯ç½‘ç»œçŽ¯å¢ƒå—é™ï¼Œéœ€è¦æœåŠ¡å™¨ä¸­è½¬ï¼Œè¿™æ˜¯ä¸»è¦åŽŸå› ï¼**

2. **æ£€æŸ¥ç½‘ç»œè´¨é‡**
   ```
   æŸ¥çœ‹æ—¥å¿—å¼€å¤´çš„ï¼š
   ðŸ” [è¯Šæ–­] ç½‘ç»œçŠ¶æ€
   ```
   - å¦‚æžœæ˜¯ 2G/3G ç½‘ç»œ â†’ ç½‘ç»œå¤ªæ…¢
   - å¦‚æžœå»¶è¿Ÿ > 500ms â†’ ç½‘ç»œå»¶è¿Ÿé«˜
   - å¦‚æžœå¸¦å®½ < 1 Mbps â†’ å¸¦å®½ä¸è¶³

3. **æŸ¥çœ‹è¯Šæ–­å»ºè®®**
   ```
   åœ¨æ—¥å¿—æœ«å°¾æŸ¥çœ‹ï¼š
   âš ï¸ æ£€æµ‹åˆ°æ€§èƒ½é—®é¢˜ï¼Œä»¥ä¸‹æ˜¯ä¼˜åŒ–å»ºè®®
   ```

## ðŸ’¡ å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### Q1: ä¸ºä»€ä¹ˆæˆ‘çš„è¿žæŽ¥éœ€è¦ TURN ä¸­ç»§ï¼Ÿ

**A:** å¯èƒ½çš„åŽŸå› ï¼š
1. å…¬å¸ç½‘ç»œé˜²ç«å¢™ä¸¥æ ¼
2. ä½¿ç”¨äº†ä»£ç†æœåŠ¡å™¨
3. è·¯ç”±å™¨ NAT ç±»åž‹ä¸º"å¯¹ç§°åž‹NAT"
4. UDP æµé‡è¢«æ‹¦æˆª

**è§£å†³æ–¹æ¡ˆï¼š**
- å°è¯•åˆ‡æ¢åˆ°æ‰‹æœºçƒ­ç‚¹æµ‹è¯•
- æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
- è”ç³»ç½‘ç»œç®¡ç†å‘˜
- è”ç³»åŽç«¯ä¼˜åŒ– TURN æœåŠ¡å™¨

### Q2: è¿žæŽ¥æ—¶é—´æ³¢åŠ¨å¾ˆå¤§æ€Žä¹ˆåŠžï¼Ÿ

**A:** å»ºè®®ï¼š
- æµ‹è¯• 3-5 æ¬¡ï¼Œè®°å½•æ¯æ¬¡è€—æ—¶
- è§‚å¯Ÿæ˜¯å¦ç¨³å®šæ…¢
- æ£€æŸ¥ç½‘ç»œæ˜¯å¦æœ‰å…¶ä»–å ç”¨
- æŸ¥çœ‹æ˜¯å¦æœ‰ VPN æˆ–ä»£ç†

### Q3: å…¶ä»–é˜¶æ®µä¹Ÿå¾ˆæ…¢æ€Žä¹ˆåŠžï¼Ÿ

**A:** æ ¹æ®å…·ä½“é˜¶æ®µï¼š
- **éŸ³é¢‘è½¨é“æ…¢**ï¼šæ£€æŸ¥éº¦å…‹é£Žæƒé™ã€éŸ³é¢‘é©±åŠ¨
- **è§†é¢‘è½¨é“æ…¢**ï¼šæ£€æŸ¥æ‘„åƒå¤´æƒé™ã€ç¡¬ä»¶æ€§èƒ½
- **å‘å¸ƒè½¨é“æ…¢**ï¼šæ£€æŸ¥ä¸Šä¼ å¸¦å®½ã€ICE åå•†

## ðŸ“„ ç›¸å…³æ–‡ä»¶

- è¯Šæ–­è¯¦ç»†æ–‡æ¡£ï¼š`LIVEKIT_DIAGNOSTIC_GUIDE.md`
- ä¿®æ”¹çš„ä»£ç æ–‡ä»¶ï¼š`src/hooks/useLiveKit.js`

## ðŸ“ž éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æžœé‡åˆ°é—®é¢˜ï¼Œè¯·æä¾›ï¼š
1. âœ… å®Œæ•´è¯Šæ–­æŠ¥å‘Šï¼ˆä»ŽæŽ§åˆ¶å°å¤åˆ¶ï¼‰
2. âœ… æµ‹è¯•çŽ¯å¢ƒæè¿°ï¼ˆå…¬å¸/å®¶åº­/æ‰‹æœºçƒ­ç‚¹ï¼‰
3. âœ… æ˜¯å¦ä½¿ç”¨ä»£ç†/VPN
4. âœ… æµè§ˆå™¨å’Œç³»ç»Ÿç‰ˆæœ¬
5. âœ… å¤šæ¬¡æµ‹è¯•çš„è€—æ—¶å¯¹æ¯”

---

**æ›´æ–°æ—¶é—´ï¼š** 2026-01-29  
**ä¿®æ”¹è€…ï¼š** AI Assistant
